name: Deploy from timeline
on:
  issue_comment:
    types: [created]

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: ${{
        (github.event.issue.number == 1)
        && (github.actor == github.repository_owner)
      }}
    steps:
      - id: parse
        env:
          COMMENT: ${{ github.event.comment.body }}
        run: |
          variables=(
            'BRANCH_OR_HASH'
          )
          echo A $variables
          IFS=$'\n'
          echo A2 $IFS
          echo A3 "$COMMENT"
          readarray -t values <<< "$COMMENT"
          echo B $values
          for i in ${!variables[@]}; do
            echo "${variables[i]}=${values[i]}" >> $GITHUB_OUTPUT
          done

  call:
    needs: deploy
    uses: /.github/workflows/deploy.yml@main
    with:
      branch_or_hash: ${{ needs.deploy.steps.parse.outputs.BRANCH_OR_HASH }}
